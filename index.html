<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Posts</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/svg+xml" href="favicon_claro.svg" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/svg+xml" href="favicon_oscuro.svg" media="(prefers-color-scheme: dark)">
    <!-- Configuration -->
    <script>
        const CONFIG = {
            API_URL: "__API_URL_PLACEHOLDER__"
        };
    </script>
    <!-- <script src="config.js"></script> -->
</head>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        background-color: #1A1B28;
        color: #E0E0E0;
        }
    .card-gradient-border {
    /* 1. Ancho del borde y color de reserva */
            border: 1px solid transparent;
        border-radius: 2rem;
        /* El redondeo que quieres */

        /* 2. El fondo interior (sólido) y el fondo exterior (gradiente) */
        background-image:
            linear-gradient(#20212f, #20212f),
            /* Color de fondo interior */
            linear-gradient(to right, #9D59E7, #6641A5);
        /* Tu gradiente para el borde */

        /* 3. Origen y recorte de los fondos */
        background-origin: border-box;
        /* El origen de ambos fondos es el borde */

        /* 4. ¡La magia! */
        /* El primer fondo (sólido) se recorta hasta el padding. */
        /* El segundo fondo (gradiente) se recorta hasta el borde. */
        background-clip: padding-box, border-box;
    }
    .input-error {
        border-color: #ef4444 !important;
        box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2) !important;
    }
    .label-error {
        color: #ef4444 !important;
        }
    </style>
<body class="p-4 sm:p-8 flex items-center justify-center min-h-screen">
    <div class="max-w-4xl w-full mx-auto space-y-8">

        <!-- Header Section -->
        <header class="text-center space-y-4">
            <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight flex items-center justify-center">
                <span class="inline-block w-4 h-4 mr-2 bg-[#9D59E7] rounded-sm"></span>
                Generador de Contenido
            </h1>
            <p class="text-lg text-gray-400 max-w-2xl mx-auto">
                Crea publicaciones impactantes para redes sociales de forma rápida y sencilla.
            </p>
        </header>

        <!-- Main Form Card -->
        <div class="bg-[#20212f] card-gradient-border shadow-xl space-y-6 p-6 sm:p-12">

            <!-- Input Fields -->
            <div class="space-y-6">
                <!-- Post Topic -->
                <div>
                    <label id="post-topic-label" for="post-topic" class="block text-sm font-semibold text-gray-300 mb-2">¿Sobre qué quieres hablar?</label>
                    <textarea id="post-topic" rows="2" class="w-full p-4 rounded-xl bg-[#20212f] border border-[#4A4B60] text-[#E0E0E0] focus:border-[#9D59E7] focus:outline-none focus:ring-2 focus:ring-[#9D59E7]" placeholder="Ej: La importancia de la sostenibilidad en la moda"></textarea>
                </div>
                <!-- Post Objective -->
                <div>
                    <label id="post-objective-label" for="post-objective" class="block text-sm font-semibold text-gray-300 mb-2">¿Qué quieres lograr con este post?</label>
                    <textarea id="post-objective" rows="2" class="w-full p-4 rounded-xl bg-[#20212f] border border-[#4A4B60] text-[#E0E0E0] focus:border-[#9D59E7] focus:outline-none focus:ring-2 focus:ring-[#9D59E7]" placeholder="Ej: Mostrar un problema, generar debate, posicionar a Camarai, etc."></textarea>
                </div>
                <!-- Post Details -->
                <div>
                    <label id="post-details-label" for="post-details" class="block text-sm font-semibold text-gray-300 mb-2">Detalles del post</label>
                    <textarea id="post-details" rows="4" class="w-full p-4 rounded-xl bg-[#20212f] border border-[#4A4B60] text-[#E0E0E0] focus:border-[#9D59E7] focus:outline-none focus:ring-2 focus:ring-[#9D59E7]" placeholder="Cualquier dato, reflexión, historia, cifra o enfoque que quieras incluir."></textarea>
                </div>
                <!-- Image Scenario -->
                <div>
                    <label for="image-scenary" class="block text-sm font-semibold text-gray-300 mb-2">Escenario de la imagen (OPCIONAL)</label>
                    <textarea id="image-scenary" rows="2" class="w-full p-4 rounded-xl bg-[#20212f] border border-[#4A4B60] text-[#E0E0E0] focus:border-[#9D59E7] focus:outline-none focus:ring-2 focus:ring-[#9D59E7]" placeholder="Describe el escenario, ambiente o contexto visual que quieres para la imagen del post."></textarea>
                </div>
            </div>

            <!-- Post Format Buttons -->
            <div class="pt-4">
                <p class="text-sm font-semibold text-gray-300 mb-4">Selecciona el formato:</p>
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button class="px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 bg-[#20212f] text-[#9D59E7] border border-[#9D59E7] hover:bg-[#28293d]" id="narrative-btn">Narrativo</button>
                    <button class="px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 bg-[#20212f] text-[#9D59E7] border border-[#9D59E7] hover:bg-[#28293d]" id="carousel-btn">Carrusel</button>
                </div>
            </div>

            <!-- Generate Button -->
            <div class="pt-6 text-center">
                <button id="generate-btn" class="px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 text-xl bg-[#9D59E7] text-white shadow-[0_4px_15px_rgba(157,89,231,0.4)] hover:bg-[#8A46D4] hover:shadow-[0_6px_20px_rgba(138,70,212,0.6)]">
                    Generar Post
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="bg-[#20212f] card-gradient-border shadow-xl text-center p-6 sm:p-12 hidden">
            <div class="flex flex-col items-center space-y-4">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#9D59E7]"></div>
                <h2 class="text-xl sm:text-2xl font-bold text-[#9D59E7]">Generando contenido...</h2>
                <p class="text-gray-400">Esto puede tomar unos momentos</p>
            </div>
        </div>

        <!-- Generated Post Section (Initially hidden) -->
        <div id="generated-content" class="space-y-8 hidden">
            <!-- Generated Post Text -->
            <div class="bg-[#20212f] card-gradient-border shadow-xl p-6 sm:p-12">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl sm:text-2xl font-bold">Texto del Post</h2>
                    <button id="copy-text-btn" class="flex items-center space-x-2 px-4 py-2 bg-[#20212f] text-[#9D59E7] border border-[#9D59E7] rounded-lg hover:bg-[#28293d] transition-all duration-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <span class="text-sm">Copiar</span>
                    </button>
                </div>
                <div id="post-text-output" class="text-base text-gray-400 leading-relaxed space-y-4">
                    <!-- The generated post text will be inserted here. -->
                    <p>
                        [El texto del post generado se mostrará aquí. Será una historia, un dato o un carrusel dependiendo del formato seleccionado. Este es un texto de ejemplo para mostrar cómo se vería.]
                    </p>
                    <p>
                        "En un mundo donde lo efímero a menudo supera a lo duradero, la sostenibilidad en la moda emerge no solo como una tendencia, sino como un imperativo."
                    </p>
                </div>
            </div>

            <!-- Generated Post Image -->
            <div class="bg-[#20212f] card-gradient-border shadow-xl p-6 sm:p-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl sm:text-2xl font-bold">Imagen del Post</h2>
                    <button id="download-image-btn" class="flex items-center space-x-2 px-4 py-2 bg-[#20212f] text-[#9D59E7] border border-[#9D59E7] rounded-lg hover:bg-[#28293d] transition-all duration-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span class="text-sm">Descargar</span>
                    </button>
                </div>
                <div class="flex justify-center items-center">
                <img id="post-image-output" src="https://placehold.co/800x600/20212f/E0E0E0?text=Imagen+Generada" alt="Imagen generada para el post" class="w-full h-auto rounded-2xl">
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="pt-4 flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                <button id="regenerate-btn" class="px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 bg-[#20212f] text-[#9D59E7] border border-[#9D59E7] hover:bg-[#28293d] w-full sm:w-auto">Reintentar</button>
                <button id="add-context-btn" class="px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 bg-[#20212f] text-[#9D59E7] border border-[#9D59E7] hover:bg-[#28293d] w-full sm:w-auto">Añadir más contexto</button>
                <button id="save-all-btn" class="px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 bg-[#9D59E7] text-white shadow-[0_4px_15px_rgba(157,89,231,0.4)] hover:bg-[#8A46D4] hover:shadow-[0_6px_20px_rgba(138,70,212,0.6)] w-full sm:w-auto">Guardar</button>
            </div>
        </div>

    </div>

    <!-- Sistema de Notificaciones -->
    <div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2">
        <!-- Las notificaciones se insertarán aquí dinámicamente -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const generateBtn = document.getElementById('generate-btn');
            const generatedContent = document.getElementById('generated-content');
            const loadingState = document.getElementById('loading-state');
            const postTextOutput = document.getElementById('post-text-output');
            const postImageOutput = document.getElementById('post-image-output');
            const copyTextBtn = document.getElementById('copy-text-btn');
            const downloadImageBtn = document.getElementById('download-image-btn');
            const saveAllBtn = document.getElementById('save-all-btn');
            const regenerateBtn = document.getElementById('regenerate-btn');
            const addContextBtn = document.getElementById('add-context-btn');
            const notificationContainer = document.getElementById('notification-container');
            const narrativeBtn = document.getElementById('narrative-btn');
            const carouselBtn = document.getElementById('carousel-btn');
            // Referencias a los inputs y labels para validación
            const postTopicInput = document.getElementById('post-topic');
            const postObjectiveInput = document.getElementById('post-objective');
            const postDetailsInput = document.getElementById('post-details');
            const imageScenaryInput = document.getElementById('image-scenary');
            const postTopicLabel = document.getElementById('post-topic-label');
            const postObjectiveLabel = document.getElementById('post-objective-label');
            const postDetailsLabel = document.getElementById('post-details-label');

            // Función para convertir base64 a imagen
            function convertirBase64AImagen(base64String) {
                try {
                    // Crear un elemento img con la imagen en base64
                    const img = new Image();
                    img.src = `data:image/png;base64,${base64String}`;
                    return img.src;
                } catch (error) {
                    console.error('Error al convertir base64 a imagen:', error);
                    return null;
                }
            }

            // Función para limpiar errores visuales
            function limpiarErrores() {
                const inputs = [postTopicInput, postObjectiveInput, postDetailsInput];
                const labels = [postTopicLabel, postObjectiveLabel, postDetailsLabel];
                
                inputs.forEach(input => {
                    input.classList.remove('input-error');
                });
                
                labels.forEach(label => {
                    label.classList.remove('label-error');
                });
            }

            // Función para marcar campos con error
            function marcarError(input, label) {
                input.classList.add('input-error');
                label.classList.add('label-error');
            }

            // Función para validar campos obligatorios
            function validarCampos() {
                limpiarErrores();
                let hayErrores = false;
                let camposFaltantes = [];

                if (!postTopicInput.value.trim()) {
                    marcarError(postTopicInput, postTopicLabel);
                    hayErrores = true;
                    camposFaltantes.push('¿Sobre qué quieres hablar?');
                }

                if (!postObjectiveInput.value.trim()) {
                    marcarError(postObjectiveInput, postObjectiveLabel);
                    hayErrores = true;
                    camposFaltantes.push('¿Qué quieres lograr con este post?');
                }

                if (!postDetailsInput.value.trim()) {
                    marcarError(postDetailsInput, postDetailsLabel);
                    hayErrores = true;
                    camposFaltantes.push('Detalles del post');
                }

                // Mostrar notificación si hay errores
                if (hayErrores) {
                    mostrarNotificacion(`Faltan campos obligatorios: ${camposFaltantes.join(', ')}`, 'error');
                }

                return !hayErrores;
            }

            // Sistema de notificaciones
            function mostrarNotificacion(mensaje, tipo = 'info') {
                const notification = document.createElement('div');
                const id = 'notification-' + Date.now();
                
                let bgColor, textColor, icon;
                switch(tipo) {
                    case 'error':
                        bgColor = 'bg-red-600';
                        textColor = 'text-white';
                        icon = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>`;
                        break;
                    case 'success':
                        bgColor = 'bg-green-600';
                        textColor = 'text-white';
                        icon = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`;
                        break;
                    case 'warning':
                        bgColor = 'bg-yellow-600';
                        textColor = 'text-white';
                        icon = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>`;
                        break;
                    default:
                        bgColor = 'bg-blue-600';
                        textColor = 'text-white';
                        icon = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>`;
                }

                notification.innerHTML = `
                    <div class="${bgColor} ${textColor} px-4 py-3 rounded-lg shadow-lg flex items-center space-x-3 max-w-sm transform transition-all duration-300 translate-x-full opacity-0" id="${id}">
                        <div class="flex-shrink-0">
                            ${icon}
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">${mensaje}</p>
                        </div>
                        <button class="flex-shrink-0 ml-2 text-white hover:text-gray-200 close-notification-btn">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                `;

                notificationContainer.appendChild(notification);

                // Agregar event listener al botón de cerrar
                const closeBtn = notification.querySelector('.close-notification-btn');
                closeBtn.addEventListener('click', () => {
                    cerrarNotificacion(id);
                });

                // Animar entrada
                setTimeout(() => {
                    const element = document.getElementById(id);
                    element.classList.remove('translate-x-full', 'opacity-0');
                    element.classList.add('translate-x-0', 'opacity-100');
                }, 100);

                // Auto-cerrar después de 5 segundos
                setTimeout(() => {
                    cerrarNotificacion(id);
                }, 5000);
            }

            // Función para cerrar notificaciones
            function cerrarNotificacion(id) {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => {
                        element.remove();
                    }, 300);
                }
            }

            // Función para hacer la petición al webhook
            async function generarPost() {
                // Validar campos obligatorios
                if (!validarCampos()) {
                    return;
                }

                // Obtener los valores de los inputs
                const postTopic = postTopicInput.value.trim();
                const postObjective = postObjectiveInput.value.trim();
                const postDetails = postDetailsInput.value.trim();
                const imageScenary = imageScenaryInput.value.trim(); // Opcional

                // Mostrar estado de carga
                generateBtn.textContent = 'Generando...';
                generateBtn.disabled = true;
                loadingState.classList.remove('hidden');
                generatedContent.classList.add('hidden');

                try {
                    // Preparar el body de la petición
                    const requestBody = {
                        topic: postTopic,
                        objective: postObjective,
                        details: postDetails,
                        scenary: imageScenary
                    };

                    // Hacer la petición al webhook
                    const response = await fetch(CONFIG.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        throw new Error(`Error en la petición: ${response.status} ${response.statusText}`);
                    }

                    // Procesar la respuesta
                    const responseData = await response.json();
                    
                    // La respuesta es un array, tomar el primer elemento
                    const data = Array.isArray(responseData) ? responseData[0] : responseData;
                    
                    // Mostrar el prompt en el texto del post
                    if (data.prompt) {
                        // Convertir saltos de línea a <br> para mostrar correctamente el texto
                        const formattedPrompt = data.prompt.replace(/\n/g, '<br>');
                        postTextOutput.innerHTML = `<p>${formattedPrompt}</p>`;
                    }

                    // Convertir y mostrar la imagen
                    if (data.data && data.data !== "b64") {
                        const imageSrc = convertirBase64AImagen(data.data);
                        if (imageSrc) {
                            postImageOutput.src = imageSrc;
                            postImageOutput.alt = 'Imagen generada para el post';
                        }
                    } else {
                        // Si no hay imagen válida, mostrar un mensaje
                        postImageOutput.src = 'https://placehold.co/800x600/20212f/E0E0E0?text=Imagen+no+disponible';
                        postImageOutput.alt = 'Imagen no disponible';
                    }

                    // Ocultar estado de carga y mostrar contenido generado
                    loadingState.classList.add('hidden');
                generatedContent.classList.remove('hidden');
                generatedContent.scrollIntoView({ behavior: 'smooth' });

                } catch (error) {
                    console.error('Error al generar el post:', error);
                    if (error.message.includes('Error en la petición')) {
                        mostrarNotificacion('Error del servidor. Por favor, intenta de nuevo.', 'error');
                    } else {
                        mostrarNotificacion('Error de conexión. Verifica tu internet e intenta de nuevo.', 'error');
                    }
                } finally {
                    // Ocultar estado de carga y restaurar el botón
                    loadingState.classList.add('hidden');
                    generateBtn.textContent = 'Generar Post';
                    generateBtn.disabled = false;
                    mostrarNotificacion('Post generado correctamente.', 'success');
                }
            }

            // Función para copiar texto al portapapeles
            async function copiarTexto() {
                try {
                    const texto = postTextOutput.textContent || postTextOutput.innerText;
                    await navigator.clipboard.writeText(texto);
                    
                    // Cambiar temporalmente el texto del botón
                    const originalText = copyTextBtn.innerHTML;
                    copyTextBtn.innerHTML = `
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm">¡Copiado!</span>
                    `;
                    mostrarNotificacion('Contenido copiado correctamente.', 'success');
                    setTimeout(() => {
                        copyTextBtn.innerHTML = originalText;
                    }, 2000);
                } catch (error) {
                    console.error('Error al copiar texto:', error);
                    mostrarNotificacion('Error al copiar el texto. Por favor, inténtalo de nuevo.', 'error');
                }
            }

            // Función para descargar imagen
            function descargarImagen() {
                try {
                    const imagen = postImageOutput.src;
                    if (imagen && imagen !== 'https://placehold.co/800x600/20212f/E0E0E0?text=Imagen+Generada') {
                        // Crear un enlace temporal para descargar
                        const link = document.createElement('a');
                        link.href = imagen;
                        link.download = 'post-generado.png';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        // Cambiar temporalmente el texto del botón
                        const originalText = downloadImageBtn.innerHTML;
                        downloadImageBtn.innerHTML = `
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span class="text-sm">¡Descargado!</span>
                        `;
                        mostrarNotificacion('Imagen descargada correctamente.', 'success');
                        setTimeout(() => {
                            downloadImageBtn.innerHTML = originalText;
                        }, 2000);
                    } else {
                        mostrarNotificacion('No hay imagen disponible para descargar.', 'warning');
                    }
                } catch (error) {
                    console.error('Error al descargar imagen:', error);
                    mostrarNotificacion('Error al descargar la imagen. Por favor, inténtalo de nuevo.', 'error');
                }
            }

            // Función para guardar todo (copiar texto + descargar imagen)
            async function guardarTodo() {
                try {
                    // Copiar texto
                    await copiarTexto();
                    
                    // Esperar un poco y luego descargar imagen
                    setTimeout(() => {
                        descargarImagen();
                    }, 1000);
                    
                    // Cambiar temporalmente el texto del botón
                    const originalText = saveAllBtn.textContent;
                    saveAllBtn.textContent = '¡Guardado!';
                    saveAllBtn.classList.add('bg-green-600');
                    saveAllBtn.classList.remove('bg-[#9D59E7]');
                    mostrarNotificacion('Contenido guardado correctamente.', 'success');
                    setTimeout(() => {
                        saveAllBtn.textContent = originalText;
                        saveAllBtn.classList.remove('bg-green-600');
                        saveAllBtn.classList.add('bg-[#9D59E7]');
                    }, 3000);
                } catch (error) {
                    console.error('Error al guardar:', error);
                    mostrarNotificacion('Error al guardar el contenido. Por favor, inténtalo de nuevo.', 'error');
                }
            }

            // Función para el botón "Añadir más contexto"
            function añadirMasContexto() {
                mostrarNotificacion('Esta funcionalidad está en desarrollo. Próximamente disponible.', 'warning');
            }

            // Función para el botón "Rehacer"
            async function rehacerPost() {
                try {
                    // Validar campos obligatorios
                    if (!validarCampos()) {
                        return;
                    }

                    // Mostrar estado de carga
                    regenerateBtn.textContent = 'Reintentando...';
                    regenerateBtn.disabled = true;
                    loadingState.classList.remove('hidden');
                    generatedContent.classList.add('hidden');

                    // Obtener los valores de los inputs
                    const postTopic = postTopicInput.value.trim();
                    const postObjective = postObjectiveInput.value.trim();
                    const postDetails = postDetailsInput.value.trim();
                    const imageScenary = imageScenaryInput.value.trim();

                    // Preparar el body de la petición
                    const requestBody = {
                        topic: postTopic,
                        objective: postObjective,
                        details: postDetails,
                        scenary: imageScenary
                    };

                    // Hacer la petición al webhook
                    const response = await fetch(CONFIG.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        throw new Error(`Error en la petición: ${response.status} ${response.statusText}`);
                    }

                    // Procesar la respuesta
                    const responseData = await response.json();
                    const data = Array.isArray(responseData) ? responseData[0] : responseData;
                    
                    // Mostrar el prompt en el texto del post
                    if (data.prompt) {
                        const formattedPrompt = data.prompt.replace(/\n/g, '<br>');
                        postTextOutput.innerHTML = `<p>${formattedPrompt}</p>`;
                    }

                    // Convertir y mostrar la imagen
                    if (data.data && data.data !== "b64") {
                        const imageSrc = convertirBase64AImagen(data.data);
                        if (imageSrc) {
                            postImageOutput.src = imageSrc;
                            postImageOutput.alt = 'Imagen generada para el post';
                        }
                    } else {
                        postImageOutput.src = 'https://placehold.co/800x600/20212f/E0E0E0?text=Imagen+no+disponible';
                        postImageOutput.alt = 'Imagen no disponible';
                    }

                    // Ocultar estado de carga y mostrar contenido generado
                    loadingState.classList.add('hidden');
                    generatedContent.classList.remove('hidden');
                    generatedContent.scrollIntoView({ behavior: 'smooth' });
                } catch (error) {
                    console.error('Error al regenerar el post:', error);
                    if (error.message.includes('Error en la petición')) {
                        mostrarNotificacion('Error del servidor al regenerar. Por favor, intenta de nuevo.', 'error');
                    } else {
                        mostrarNotificacion('Error de conexión al regenerar. Verifica tu internet e intenta de nuevo.', 'error');
                    }
                } finally {
                    // Ocultar estado de carga y restaurar el botón
                    loadingState.classList.add('hidden');
                    regenerateBtn.textContent = 'Reintentar';
                    regenerateBtn.disabled = false;
                    mostrarNotificacion('Post regenerado exitosamente', 'success');
                }
            }

            // Event listeners para limpiar errores al escribir
            postTopicInput.addEventListener('input', () => {
                if (postTopicInput.classList.contains('input-error')) {
                    postTopicInput.classList.remove('input-error');
                    postTopicLabel.classList.remove('label-error');
                }
            });

            postObjectiveInput.addEventListener('input', () => {
                if (postObjectiveInput.classList.contains('input-error')) {
                    postObjectiveInput.classList.remove('input-error');
                    postObjectiveLabel.classList.remove('label-error');
                }
            });

            postDetailsInput.addEventListener('input', () => {
                if (postDetailsInput.classList.contains('input-error')) {
                    postDetailsInput.classList.remove('input-error');
                    postDetailsLabel.classList.remove('label-error');
                }
            });

            narrativeBtn.addEventListener('click', () => {
                mostrarNotificacion('Esta funcionalidad está en desarrollo. Próximamente disponible.', 'warning');
            });
            carouselBtn.addEventListener('click', () => {
                mostrarNotificacion('Esta funcionalidad está en desarrollo. Próximamente disponible.', 'warning');
            });

            // Event listeners principales
            copyTextBtn.addEventListener('click', copiarTexto);
            downloadImageBtn.addEventListener('click', descargarImagen);
            saveAllBtn.addEventListener('click', guardarTodo);
            generateBtn.addEventListener('click', generarPost);
            regenerateBtn.addEventListener('click', rehacerPost);
            addContextBtn.addEventListener('click', añadirMasContexto);
        });
    </script>
</body>
</html>
